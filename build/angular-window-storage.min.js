/**
* angular-window-storage 
* Angular module to ease the access of localStorage, sessionStorage and cookie. 
* Author: Jose Rocha 
* Version: 0.1.3 
* Date: 2017-05-10 
* Project github: https://github.com/JoseCMRocha/angular-window-storage
* License: MIT 
*/
!function(a,b){b.module("WindowStorageModule",[]).provider("windowStorageService",function(a){var c=["__","WINDOW_STORAGE_TTL"].join(""),d=[".","__","CHUNK"].join("");this._defaults={prefix:"ws_",storageType:"sessionStorage",cookies:{path:null,domain:null,ttl:31536e6,secure:!1},allowWebStorage:!0,allowCookies:!0,defaultToCookies:!0,cookiesEncoderComponentFn:encodeURIComponent,cookiesDecoderComponentFn:decodeURIComponent,webStorageEncoderComponentFn:null,webStorageDecoderComponentFn:null},this.setPrefix=function(a){return b.isString(a)&&(this._defaults.prefix=a),this},this.setDefaultStorageType=function(a){return"sessionStorage"!==a&&"localStorage"!==a&&"cookie"!==a||(this._defaults.storageType=a),this},this.setCookiesPath=function(a){return b.isString(a)&&(this._defaults.cookies.path=a),this},this.setCookiesDomain=function(a){return b.isString(a)&&(this._defaults.cookies.domain=a),this},this.setCookiesExpires=function(a){return b.isNumber(a)&&a>0&&(this._defaults.cookies.expires=a),b.isDate(a)&&(this._defaults.cookies.expires=+new Date(a)),this},this.setCookiesSecure=function(a){return"boolean"==typeof a&&(this._defaults.cookies.secure=a),this},this.setCookiesDefaults=function(a){return b.isObject(a)&&(a.path&&setCookiesPath(a.path),a.domain&&setCookiesDomain(a.domain),a.expires&&setCookiesExpires(a.expires),a.secure&&setCookiesSecure(a.secure)),this},this.setAllowWebStorage=function(a){return"boolean"==typeof a&&(this._defaults.allowWebStorage=a),this},this.setAllowCookies=function(a){return"boolean"==typeof a&&(this._defaults.allowCookies=a),this},this.setDefaultToCookies=function(a){return"boolean"==typeof a&&(this._defaults.defaultToCookies=a),this},this.setCookiesEncoderComponentFn=function(a){return b.isFunction(a)&&(this._defaults.cookiesEncoderComponentFn=a),this},this.setCookiesDecoderComponentFn=function(a){return b.isFunction(a)&&(this._defaults.cookiesDecoderComponentFn=a),this},this.setWebStorageEncoderComponentFn=function(a){return b.isFunction(a)&&(this._defaults.webStorageEncoderComponentFn=a),this},this.setWebStorageDecoderComponentFn=function(a){return b.isFunction(a)&&(this._defaults.webStorageDecoderComponentFn=a),this},this.$get=["$window","$rootScope","$timeout","$document","$browser",function(a,e,f,g,h){var i=this,j=i._defaults,k=[],l={settings:null,webStorage:null,cookies:null,storageTTl:null},m=function(){try{return"."!==j.prefix.substr(-1)&&(j.prefix=j.prefix?j.prefix+".":""),!0}catch(a){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_FAILED_TO_INIT_SETTINGS",message:a.message}),!1}},n=function(){if(!j.allowWebStorage)return!1;try{var b=function(b){var c=b in a&&null!==a[b];if(c){var d=q(Math.round(1e4*Math.random()));a[b].setItem(b,d,""),a[b].removeItem(b,d)}return c},c=b("localStorage"),d=b("sessionStorage");return c&&d}catch(a){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_FAILED_TO_INIT_WEB_STORAGE",message:a.message}),!1}},o=function(){if(!j.allowCookies)return!1;try{var c=b.isDefined(a.navigator)&&a.navigator.cookieEnabled||b.isDefined(g.cookie);if(c){var d=Math.round(1e4*Math.random()),f=Math.round(1e4*Math.random());t(d,f),c=g.cookie.indexOf(j.cookiesEncoderComponentFn(d))>-1,t(d,null)}return c}catch(a){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_FAILED_TO_INIT_COOKIE_STORAGE",message:a.message}),!1}},p=function(){if(!l.webStorage)return!1;var a=function(a){var b=H(a);try{for(var d in b){var f=b[d],g=D(a,[c,f].join("."));g&&C(a,f,g-+new Date)}return!0}catch(b){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_FAILED_TO_INIT_STORAGE_TTL",message:b.message,storageType:a}),!1}},b=a("localStorage"),d=a("sessionStorage");return b&&d},q=function(a){return j.prefix+a},r=function(a,b,c,f,g,h){var i=j.cookiesEncoderComponentFn(a),k=j.cookiesEncoderComponentFn(b),l=f?";path="+f:"";l+=g?";domain="+g:"",l+=c?";expires="+c.toUTCString():"",l+=h?";secure":"";var m=k.length,n=i.length+l.length,o=m+n+1,p=d.length+"0000".length+"OF".length+"0000".length;if(o>4093&&n+p<4093){var q=Math.ceil(m/(4093-n-p)),r=("0000"+q).slice(-"0000".length);q>30&&e.$broadcast("WindowStorageModule.warning",{type:"WINDOW_STORAGE_COOKIE_STORAGE_VALUE_TO_BIG",message:"Cookie '"+a+"' possibly not set or overflowed because it was too large even to divide in chunks ("+q+" > 30 chunks)!"});for(var s=[],t=Math.ceil(m/q),u=0;u<q;u++){var v=u+1,w=("0000"+v).slice(-"0000".length),x=[i,d,w,"OF",r].join("");x+="="+k.substr(u*t,t),x+=l,s.push(x)}return s}return o>4093&&e.$broadcast("WindowStorageModule.warning",{type:"WINDOW_STORAGE_COOKIE_STORAGE",message:"Cookie '"+a+"' possibly not set or overflowed because it was too large ("+o+" > 4093 bytes)!"}),[i+"="+k+l]},s=function(a,c,e,f){var h=new Date(0),i=j.cookiesEncoderComponentFn(a),k=[i,d].join(""),l=j.cookiesEncoderComponentFn(""),m=c?";path="+c:"";m+=e?";domain="+e:"",m+=h?";expires="+h.toUTCString():"",m+=f?";secure":"";var n=g.cookie;n=n.replace(/\s/g,"");var o=[],p=n.split(";");for(var q in p){var r=p[q].split("="),s=r[0];if(b.isDefined(s)&&(s===i||s.indexOf(k)>-1)){var t=s+"=";t+=l,t+=m,o.push(t)}}return o},t=function(a,c,d){d=v(d);var e,f=d.path,i=d.ttl,k=d.domain,l=d.secure;f=b.isUndefined(f)?null===j.cookies.path?h.baseHref():j.cookies.path:f;var m=+new Date;e=b.isUndefined(i)?new Date(m+j.cookies.ttl):b.isDate(i)?i:b.isNumber(i)?new Date(m+i):new Date(0),k=b.isUndefined(k)?null===j.cookies.domain?"":j.cookies.domain:k,l=b.isUndefined(l)?j.cookies.secure:l;var n=s(a,f,k,l);for(var o in n)g.cookie=n[o];if(!(b.isUndefined(c)||null===c||e<new Date(m))){n=r(a,c,e,f,k,l);for(var p in n)g.cookie=n[p]}},u=function(){var a=g.cookie;a=a.replace(/\s/g,"");var c={},e=a.split(";");for(var f in e){var h=e[f].split("="),i=h[0].split(d),k=j.cookiesDecoderComponentFn(i[0]);if(k){var l=h[1];if(b.isDefined(i[1])){var m=i[1].split("OF"),n=parseInt(m[0]),o=parseInt(m[1]),p=c[k]||"";n==o?c[k]+=l:c[k]=p.slice(0,(n-1)*l.length)+l+p.slice((n-1)*l.length)}else c[k]=l}}for(var q in c)c.hasOwnProperty(q)&&(c[q]=j.cookiesDecoderComponentFn(c[q]));return c},v=function(a){return b.isNumber(a)||b.isDate(a)||b.isString(a)?{ttl:a}:a||{}},w=function(a,b){var c=j.prefix;j.prefix=[c,"__",a,"."].join("");var d=b();return j.prefix=c,d},x=function(a){return"sessionStorage"===a||"localStorage"===a||"cookie"===a},y=function(a){return"sessionStorage"===a||"localStorage"===a},z=function(a){return"cookie"===a},A=function(c,d,f,g){if(x(c)||(c=j.storageType),y(c)&&!l.webStorage)return!!j.defaultToCookies&&w(c,B.bind(this,d,f,g));if(z(c))return B(d,f,g);if(g=v(g),b.isUndefined(f)||null===f)return F(c,d);try{var h=b.toJson(f);return j.webStorageEncoderComponentFn&&j.webStorageDecoderComponentFn&&(h=j.webStorageEncoderComponentFn(h)),a[c].setItem(q(d),h),!g.ttl||C(c,d,g.ttl)}catch(a){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_SET_METHOD",message:a.message,key:d,storageType:c}),!1}},B=function(a,c,d){if(!l.cookies)return!1;(b.isUndefined(c)||null===c)&&G(a),d=v(d);try{t(q(a),b.toJson(c),d.ttl,d.path,d.domain,d.secure)}catch(b){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_SET_COOKIE_METHOD",message:b.message,key:a,storageType:"cookie"}),!1}},C=function(d,e,g){if(x(d)||(d=j.storageType),!l.webStorage||z(d))return!1;var h=+new Date;if(0===(g=b.isDate(g)?+new Date(new Date(g)-h):b.isNumber(g)?g:0))return!0;if(g<0&&F(d,e),q(e)in a[d]){var i=[c,e].join(".");if(q(i)in a[d]){a[d].removeItem(q(i));for(var m=k.length-1;m>=0;m--)k[m].key===e&&(f.cancel(k[m].promise),k.splice(m,1))}var n=+new Date(h+g),o=f(function(){F(d,e)},g);k.push({key:e,promise:o}),A(d,i,n)}return!0},D=function(c,d){if(x(c)||(c=j.storageType),y(c)&&!l.webStorage)return j.defaultToCookies?w(c,E.bind(this,d)):null;if(z(c))return E(d);try{var f=a[c].getItem(q(d));j.webStorageEncoderComponentFn&&j.webStorageDecoderComponentFn&&(f=j.webStorageDecoderComponentFn(f));try{return b.fromJson(f)}catch(a){return f}}catch(a){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_GET_METHOD",message:a.message,method:"get",key:d,storageType:c}),null}},E=function(a){if(!l.cookies)return null;try{var c=u()[q(a)];b.isUndefined(c)&&(c=null);try{return b.fromJson(c)}catch(a){return c}}catch(b){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_GET_COOKIE_METHOD",message:b.message,key:a,storageType:"cookie"}),null}},F=function(){if(arguments.length<2)return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_WRONG_NUMBER_OF_ARGUMENTS"}),!1;var b=Array.prototype.slice.call(arguments),d=b.splice(0,1)[0];if(x(d)||(d=j.storageType),y(d)&&!l.webStorage){if(!j.defaultToCookies)return!1;return w(d,function(a){return G.apply(this,a)}.bind(this,b))}if(z(d))return G.apply(this,b);var g=!0;for(var h in b){var i=b[h];try{var m=[c,i].join(".");if(q(m)in a[d]){a[d].removeItem(q(m));for(var n=k.length-1;n>=0;n--)k[n].key===i&&(f.cancel(k[n].promise),k.splice(n,1))}a[d].removeItem(q(i))}catch(a){e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_REMOVE_METHOD",message:a.message,key:i,storageType:d}),g=!1}}return g},G=function(){if(!l.cookies)return!1;for(var a=!0,b=0;b<arguments.length;b++){var c=arguments[b];try{t(q(c),null)}catch(b){e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_REMOVE_COOKIE_METHOD",message:b.message,key:c,storageType:"cookie"}),a=!1}}return a},H=function(d,f){if(x(d)||(d=j.storageType),y(d)&&!l.webStorage)return j.defaultToCookies?w(d,I.bind(this,f)):null;if(z(d))return I(f);b.isUndefined(f)&&(f="");var g=q([c,f].join("."));f=q(f);var h=[];for(var i in a[d])if(i.substr(0,g.length)!==g&&i.substr(0,f.length)===f)try{h.push(i.substr(j.prefix.length))}catch(a){e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_GETKEYS_METHOD",message:a.message,key:i,storageType:d})}return h},I=function(a){if(!l.cookies)return null;b.isUndefined(a)&&(a=""),a=q(a);var c=[],d=Object.keys(u());for(var f in d){var g=d[f];if("__"!==g.substr(j.prefix.length,"__".length)&&g.substr(0,a.length)===a)try{c.push(g.substr(j.prefix.length))}catch(a){e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_GETKEYS_COOKIES_METHOD",message:a.message,key:g,storageType:"cookie"})}}return c},J=function(a,b){if(z(a))return K(b);var c=H(a,b)||[];return 0===c.length||(c.splice(0,0,a),F.apply(this,c))},K=function(a){var b=I(a)||[];return 0===b.length||G.apply(this,b)},L=function(a){return z(a)?M():(H(a)||[]).length},M=function(){return(I()||[]).length},N=function(a,b){return z(a)?O(b):(H(a)||[]).indexOf(b)},O=function(a){return(I()||[]).indexOf(a)},P=function(){return j.storageType},Q=function(a){return!!x(a)&&(j.storageType=a,!0)},R=function(){return j.prefix},S=function(){var a=J("localStorage"),b=J("sessionStorage"),c=K();return a&&b&&c},T=function(a,b,c,d){return b.indexOf("__")>-1?(e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_SET_METHOD",message:"Reserved key '__'",key:b,storageType:a}),!1):A(a,b,c,d)},U={set:function(a,b,c){return T("sessionStorage",a,b,c)},get:function(a){return D("sessionStorage",a)},remove:function(){var a=Array.prototype.slice.call(arguments);return a.splice(0,0,"sessionStorage"),F.apply(this,a)},getKeys:function(a){return H("sessionStorage",a)},clear:function(){return J("sessionStorage")},setTTL:function(a,b){return C("sessionStorage",a,b)},length:function(){return L("sessionStorage")},key:function(a){return N("sessionStorage",a)}},V={set:function(a,b,c){return T("localStorage",a,b,c)},get:function(a){return D("localStorage",a)},remove:function(){var a=Array.prototype.slice.call(arguments);return a.splice(0,0,"localStorage"),F.apply(this,a)},getKeys:function(a){return H("localStorage",a)},clear:function(){return J("localStorage")},setTTL:function(a,b){return C("localStorage",a,b)},length:function(){return L("localStorage")},key:function(a){return N("localStorage",a)}},W={set:function(a,b,c){return T("cookie",a,b,c)},get:function(a){return D("cookie",a)},remove:function(){var a=Array.prototype.slice.call(arguments);return a.splice(0,0,"cookie"),F.apply(this,a)},getKeys:function(a){return H("cookie",a)},clear:function(){return J("cookie")},setTTL:function(a,b){return console.log("set ttl not available for cookies"),!1},length:function(){return L("cookie")},key:function(a){return N("cookie",a)}};return function(){g?g[0]&&(g=g[0]):g=document,l.settings=m(),l.webStorage=n(),l.cookies=o(),l.storageTTl=p()}(),{sessionStorage:U,localStorage:V,cookies:W,clearAll:S,clear:J.bind(this,null),clearSessionStorage:U.clear,clearLocalStorage:V.clear,clearCookies:W.clear,getKeys:H.bind(this,null),getKeysFromSessionStorage:U.getKeys,getKeysFromLocalStorage:V.getKeys,getKeysFromCookies:W.getKeys,remove:F.bind(this,null),removeFromSessionStorage:U.remove,removeFromLocalStorage:V.remove,removeFromCookies:W.remove,get:D.bind(this,null),getFromSessionStorage:U.get,getFromLocalStorage:V.get,getFromCookies:W.get,set:A.bind(this,null),setToSessionStorage:U.set,setToLocalStorage:V.set,setToCookies:W.set,setTTL:C.bind(this,null),setTTLToSessionStorage:U.setTTL,setTTLToLocalStorage:V.setTTL,setTTlToCookies:W.setTTL,length:L.bind(this,null),lengthOfSessionStorage:U.length,lengthOfLocalStorage:V.length,lengthOfCookies:W.length,key:N.bind(this,null),keySessionStorage:U.length,keyLocalStorage:V.length,keyCookies:W.length,getDefaultStorageType:P,setDefaultStorageType:Q,getPrefix:R}}]})}(window,window.angular);
//# sourceMappingURL=angular-window-storage.min.js.map