/**
* angular-window-storage 
* Angular module to ease the access of localStorage, sessionStorage and cookie. 
* Author: Jose Rocha 
* Version: 0.1.3 
* Date: 2017-05-08 
* Project github: https://github.com/JoseCMRocha/angular-window-storage
* License: MIT 
*/
!function(a,b){b.module("WindowStorageModule",[]).provider("windowStorageService",function(a){var c=["__","window_storage_TTL"].join("");this._defaults={prefix:"ws_",storageType:"sessionStorage",cookies:{path:null,domain:null,ttl:31536e6,secure:!1},allowWebStorage:!0,allowCookies:!0,defaultToCookies:!0},this.setPrefix=function(a){return b.isString(a)&&(this._defaults.prefix=a),this},this.setDefaultStorageType=function(a){return"sessionStorage"!==a&&"localStorage"!==a&&"cookie"!==a||(this._defaults.storageType=a),this},this.setCookiesPath=function(a){return b.isString(a)&&(this._defaults.cookies.path=a),this},this.setCookiesDomain=function(a){return b.isString(a)&&(this._defaults.cookies.domain=a),this},this.setCookiesExpires=function(a){return b.isNumber(a)&&a>0&&(this._defaults.cookies.expires=a),b.isDate(a)&&(this._defaults.cookies.expires=+new Date(a)),this},this.setCookiesSecure=function(a){return"boolean"==typeof a&&(this._defaults.cookies.secure=a),this},this.setCookiesDefaults=function(a){return b.isObject(a)&&(a.path&&setCookiesPath(a.path),a.domain&&setCookiesDomain(a.domain),a.expires&&setCookiesExpires(a.expires),a.secure&&setCookiesSecure(a.secure)),this},this.setAllowWebStorage=function(a){return"boolean"==typeof a&&(this._defaults.allowWebStorage=a),this},this.setAllowCookies=function(a){return"boolean"==typeof a&&(this._defaults.allowCookies=a),this},this.setDefaultToCookies=function(a){return"boolean"==typeof a&&(this._defaults.defaultToCookies=a),this},this.$get=["$window","$rootScope","$timeout","$document","$browser",function(a,d,e,f,g){var h=this,i=h._defaults,j=[],k={settings:null,webStorage:null,cookies:null,storageTTl:null},l=function(){try{return"."!==i.prefix.substr(-1)&&(i.prefix=i.prefix?i.prefix+".":""),!0}catch(a){return d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_FAILED_TO_INIT_SETTINGS",message:a.message}),!1}},m=function(){if(!i.allowWebStorage)return!1;try{var b=function(b){var c=b in a&&null!==a[b];if(c){var d=p(Math.round(1e4*Math.random()));a[b].setItem(b,d,""),a[b].removeItem(b,d)}return c},c=b("localStorage"),e=b("sessionStorage");return c&&e}catch(a){return d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_FAILED_TO_INIT_WEB_STORAGE",message:a.message}),!1}},n=function(){if(!i.allowCookies)return!1;try{var c=b.isDefined(a.navigator)&&a.navigator.cookieEnabled||b.isDefined(f.cookie);if(c){var e=Math.round(1e4*Math.random()),g=Math.round(1e4*Math.random());f.cookie=q(e,g),c=f.cookie.indexOf(e)>-1,f.cookie=q(e,null)}return c}catch(a){return d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_FAILED_TO_INIT_COOKIE_STORAGE",message:a.message}),!1}},o=function(){if(!k.webStorage)return!1;var a=function(a){var b=F(a);try{for(var e in b){var f=b[e],g=B(a,[c,f].join("."));g&&A(a,f,g-+new Date)}return!0}catch(b){return d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_FAILED_TO_INIT_STORAGE_TTL",message:b.message,storageType:a}),!1}},b=a("localStorage"),e=a("sessionStorage");return b&&e},p=function(a){return i.prefix+a},q=function(a,c,e,f,h,j){var k;f=b.isUndefined(f)?null===i.cookies.path?g.baseHref():i.cookies.path:f,k=b.isUndefined(e)?new Date(+new Date+i.cookies.ttl):b.isDate(e)?e:b.isNumber(e)?new Date(+new Date+e):new Date(0),h=b.isUndefined(h)?null===i.cookies.domain?"":i.cookies.domain:h,j=b.isUndefined(j)?i.cookies.secure:j,(b.isUndefined(c)||null===c)&&(k=new Date(0),c="");var l=encodeURIComponent(a)+"="+encodeURIComponent(c);l+=f?";path="+f:"",l+=h?";domain="+h:"",l+=k?";expires="+k.toUTCString():"",l+=j?";secure":"";var m=l.length+1;return m>4096&&d.$broadcast("WindowStorageModule.warning",{type:"WINDOW_STORAGE_COOKIE_STORAGE",message:"Cookie '"+a+"' possibly not set or overflowed because it was too large ("+m+" > 4096 bytes)!"}),l},r=function(a,b,c){if(!k.cookies)return!1;c=t(c),f.cookie=q(a,b,c.ttl,c.path,c.domain,c.secure)},s=function(){if(!k.cookies)return null;var a=f.cookie;a=a.replace(/\s/g,"");var b={},c=a.split(";");for(var d in c){var e=c[d].split("="),g=decodeURIComponent(e[0]),h=e[1];g&&(b[g]=decodeURIComponent(h))}return b},t=function(a){return b.isNumber(a)||b.isDate(a)||b.isString(a)?{ttl:a}:a||{}},u=function(a,b){var c=i.prefix;i.prefix=[c,"__",a,"."].join("");var d=b();return i.prefix=c,d},v=function(a){return"sessionStorage"===a||"localStorage"===a||"cookie"===a},w=function(a){return"sessionStorage"===a||"localStorage"===a},x=function(a){return"cookie"===a},y=function(c,e,f,g){if(v(c)||(c=i.storageType),w(c)&&!k.webStorage)return!!i.defaultToCookies&&u(c,z.bind(this,e,f,g));if(x(c))return z(e,f,g);if(g=t(g),b.isUndefined(f)||null===f)return D(c,e);try{return a[c].setItem(p(e),b.toJson(f)),!g.ttl||A(c,e,g.ttl)}catch(a){return d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_SET_METHOD",message:a.message,key:e,storageType:c}),!1}},z=function(a,c,e){if(!k.cookies)return!1;(b.isUndefined(c)||null===c)&&E(a),e=t(e);try{r(p(a),b.toJson(c),e.ttl,e.path,e.domain,e.secure)}catch(b){return d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_SET_COOKIE_METHOD",message:b.message,key:a,storageType:"cookie"}),!1}},A=function(d,f,g){if(v(d)||(d=i.storageType),!k.webStorage||x(d))return!1;var h=+new Date;if(0===(g=b.isDate(g)?+new Date(new Date(g)-h):b.isNumber(g)?g:0))return!0;if(g<0&&D(d,f),p(f)in a[d]){var l=[c,f].join(".");if(p(l)in a[d]){a[d].removeItem(p(l));for(var m=j.length-1;m>=0;m--)j[m].key===f&&(e.cancel(j[m].promise),j.splice(m,1))}var n=+new Date(h+g),o=e(function(){D(d,f)},g);j.push({key:f,promise:o}),y(d,l,n)}return!0},B=function(c,e){if(v(c)||(c=i.storageType),w(c)&&!k.webStorage)return i.defaultToCookies?u(c,C.bind(this,e)):null;if(x(c))return C(e);try{var f=a[c].getItem(p(e));try{return b.fromJson(f)}catch(a){return f}}catch(a){return d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_GET_METHOD",message:a.message,method:"get",key:e,storageType:c}),null}},C=function(a){if(!k.cookies)return null;try{var c=s()[p(a)];b.isUndefined(c)&&(c=null);try{return b.fromJson(c)}catch(a){return c}}catch(b){return d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_GET_COOKIE_METHOD",message:b.message,key:a,storageType:"cookie"}),null}},D=function(){if(arguments.length<2)return d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_WRONG_NUMBER_OF_ARGUMENTS"}),!1;var b=Array.prototype.slice.call(arguments),f=b.splice(0,1)[0];if(v(f)||(f=i.storageType),w(f)&&!k.webStorage){if(!i.defaultToCookies)return!1;return u(f,function(a){return E.apply(this,a)}.bind(this,b))}if(x(f))return E.apply(this,b);var g=!0;for(var h in b){var l=b[h];try{var m=[c,l].join(".");if(p(m)in a[f]){a[f].removeItem(p(m));for(var n=j.length-1;n>=0;n--)j[n].key===l&&(e.cancel(j[n].promise),j.splice(n,1))}a[f].removeItem(p(l))}catch(a){d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_REMOVE_METHOD",message:a.message,key:l,storageType:f}),g=!1}}return g},E=function(){if(!k.cookies)return!1;for(var a=!0,b=0;b<arguments.length;b++){var c=arguments[b];try{r(p(c),null)}catch(b){d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_REMOVE_COOKIE_METHOD",message:b.message,key:c,storageType:"cookie"}),a=!1}}return a},F=function(e,f){if(v(e)||(e=i.storageType),w(e)&&!k.webStorage)return i.defaultToCookies?u(e,G.bind(this,f)):null;if(x(e))return G(f);b.isUndefined(f)&&(f="");var g=p([c,f].join("."));f=p(f);var h=[];for(var j in a[e])if(j.substr(0,g.length)!==g&&j.substr(0,f.length)===f)try{h.push(j.substr(i.prefix.length))}catch(a){d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_GETKEYS_METHOD",message:a.message,key:j,storageType:e})}return h},G=function(a){if(!k.cookies)return null;b.isUndefined(a)&&(a=""),a=p(a);var c=[],e=Object.keys(s());for(var f in e){var g=e[f];if("__"!==g.substr(i.prefix.length,"__".length)&&g.substr(0,a.length)===a)try{c.push(g.substr(i.prefix.length))}catch(a){d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_GETKEYS_COOKIES_METHOD",message:a.message,key:g,storageType:"cookie"})}}return c},H=function(a,b){if(x(a))return I(b);var c=F(a,b)||[];return 0===c.length||(c.splice(0,0,a),D.apply(this,c))},I=function(a){var b=G(a)||[];return 0===b.length||E.apply(this,b)},J=function(a){return x(a)?K():(F(a)||[]).length},K=function(){return(G()||[]).length},L=function(a,b){return x(a)?M(b):(F(a)||[]).indexOf(b)},M=function(a){return(G()||[]).indexOf(a)},N=function(){return i.storageType},O=function(a){return!!v(a)&&(i.storageType=a,!0)},P=function(){return i.prefix},Q=function(){var a=H("localStorage"),b=H("sessionStorage"),c=I();return a&&b&&c},R=function(a,b,c,e){return b.indexOf("__")>-1?(d.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_SET_METHOD",message:"Reserved key '__'",key:b,storageType:a}),!1):y(a,b,c,e)},S={set:function(a,b,c){return R("sessionStorage",a,b,c)},get:function(a){return B("sessionStorage",a)},remove:function(){var a=Array.prototype.slice.call(arguments);return a.splice(0,0,"sessionStorage"),D.apply(this,a)},getKeys:function(a){return F("sessionStorage",a)},clear:function(){return H("sessionStorage")},setTTL:function(a,b){return A("sessionStorage",a,b)},length:function(){return J("sessionStorage")},key:function(a){return L("sessionStorage",a)}},T={set:function(a,b,c){return R("localStorage",a,b,c)},get:function(a){return B("localStorage",a)},remove:function(){var a=Array.prototype.slice.call(arguments);return a.splice(0,0,"localStorage"),D.apply(this,a)},getKeys:function(a){return F("localStorage",a)},clear:function(){return H("localStorage")},setTTL:function(a,b){return A("localStorage",a,b)},length:function(){return J("localStorage")},key:function(a){return L("localStorage",a)}},U={set:function(a,b,c){return R("cookie",a,b,c)},get:function(a){return B("cookie",a)},remove:function(){var a=Array.prototype.slice.call(arguments);return a.splice(0,0,"cookie"),D.apply(this,a)},getKeys:function(a){return F("cookie",a)},clear:function(){return H("cookie")},setTTL:function(a,b){return console.log("set ttl not available for cookies"),!1},length:function(){return J("cookie")},key:function(a){return L("cookie",a)}};return function(){f?f[0]&&(f=f[0]):f=document,k.settings=l(),k.webStorage=m(),k.cookies=n(),k.storageTTl=o()}(),{sessionStorage:S,localStorage:T,cookies:U,clearAll:Q,clear:H.bind(this,null),clearSessionStorage:S.clear,clearLocalStorage:T.clear,clearCookies:U.clear,getKeys:F.bind(this,null),getKeysFromSessionStorage:S.getKeys,getKeysFromLocalStorage:T.getKeys,getKeysFromCookies:U.getKeys,remove:D.bind(this,null),removeFromSessionStorage:S.remove,removeFromLocalStorage:T.remove,removeFromCookies:U.remove,get:B.bind(this,null),getFromSessionStorage:S.get,getFromLocalStorage:T.get,getFromCookies:U.get,set:y.bind(this,null),setToSessionStorage:S.set,setToLocalStorage:T.set,setToCookies:U.set,setTTL:A.bind(this,null),setTTLToSessionStorage:S.setTTL,setTTLToLocalStorage:T.setTTL,setTTlToCookies:U.setTTL,length:J.bind(this,null),lengthOfSessionStorage:S.length,lengthOfLocalStorage:T.length,lengthOfCookies:U.length,key:L.bind(this,null),keySessionStorage:S.length,keyLocalStorage:T.length,keyCookies:U.length,getDefaultStorageType:N,setDefaultStorageType:O,getPrefix:P}}]})}(window,window.angular);
//# sourceMappingURL=angular-window-storage.min.js.map