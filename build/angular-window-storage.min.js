/**
* angular-window-storage 
* Angular module to ease the access of local and session storage 
* Author Jose Rocha 
* Version 0.1.0 
* Date 2017-05-02 
* Project github https://github.com/JoseCMRocha/angular-window-storage
* License  
*/
!function(a,b){b.module("WindowStorageModule",[]).provider("windowStorageService",function(){this.prefix="ws_",this.defaultStorageType="sessionStorage",this.setPrefix=function(a){return this.prefix=a,this},this.setDefaultStorageType=function(a){return"sessionStorage"!==a&&"localStorage"!==a||(this.defaultStorageType=a),this},this.$get=["$window","$rootScope","$timeout",function(a,c,d){var e=this,f=e.prefix,g=e.defaultStorageType,h=[],i={localStorage:null,sessionStorage:null},j={settings:null,storage:null,storageTTl:null},k=function(){try{return"."!==f.substr(-1)&&(f=f?f+".":""),!0}catch(a){return c.$broadcast("WindowStorageModule.error","WINDOW_STORAGE_FAILED_TO_INIT_SETTINGS"),!1}},l=function(){try{return i.localStorage=a.localStorage,i.sessionStorage=a.sessionStorage,n()}catch(a){return c.$broadcast("WindowStorageModule.error","WINDOW_STORAGE_FAILED_TO_INIT_STORAGE"),!1}},m=function(){try{var a=v("localStorage"),b=v("sessionStorage");for(var d in a){var e=a[d];t("localStorage",["__window_storage_TTL",e].join("."))&&s("localStorage",e,expireTime-+new Date)}for(var f in b){var g=b[f];t("sessionStorage",["__window_storage_TTL",g].join("."))&&s("sessionStorage",g,expireTime-+new Date)}}catch(a){return c.$broadcast("WindowStorageModule.error","WINDOW_STORAGE_FAILED_TO_INIT_STORAGE_TTL"),!1}},n=function(){try{var a=null!==i.localStorage&&null!==i.sessionStorage;if(a){var b=q(Math.round(1e4*Math.random()));i.localStorage.setItem(b,""),i.sessionStorage.setItem(b,""),i.localStorage.removeItem(b),i.sessionStorage.removeItem(b)}return a}catch(a){return c.$broadcast("WindowStorageModule.error",a.message),!1}},o=function(){return!!j.storage||(c.$broadcast("WindowStorageModule.error","WINDOW_STORAGE_NOT_SUPPORTED"),!1)},p=function(a){return"sessionStorage"===a||"localStorage"===a||(c.$broadcast("WindowStorageModule.error","WINDOW_STORAGE_NOT_SUPPORTED"),!1)},q=function(a){return f+a},r=function(a,d,e,f){if(!o())return!1;a=p(a)?a:g,e=b.isUndefined(e)?null:b.toJson(e);try{return i[a].setItem(q(d),e),!f||s(a,d,f)}catch(b){return c.$broadcast("WindowStorageModule.error",{message:b.message,method:"set",key:d,storageType:a}),!1}},s=function(a,c,e){if(!o())return!1;if(a=p(a)?a:g,0===(e=b.isNumber(e)?e:0))return!1;if(e<0&&u(a,c),q(c)in i[a]){var f=["__window_storage_TTL",c].join(".");if(q(f)in i[a]){i[a].removeItem(q(f));for(var j=h.length-1;j>=0;j--)h[j].key===c&&(d.cancel(h[j].promise),h.splice(j,1))}var k=+new Date,l=+new Date(k+e),m=d(function(){u(a,c)},e);h.push({key:c,promise:m}),r(a,f,l)}return!0},t=function(a,d){if(!o())return null;a=p(a)?a:g;try{var e=i[a].getItem(q(d));try{return b.fromJson(e)}catch(a){return e}}catch(b){return c.$broadcast("WindowStorageModule.error",{message:b.message,method:"get",key:d,storageType:a}),null}},u=function(){if(!o())return!1;if(arguments.length<2)return c.$broadcast("WindowStorageModule.error","WINDOW_STORAGE_WRONG_NUMBER_OF_ARGUMENTS"),!1;for(var a=p(arguments[0])?arguments[0]:g,b=!0,e=1;e<arguments.length;e++){var f=arguments[e];try{var j=["__window_storage_TTL",f].join(".");if(q(j)in i[a]){i[a].removeItem(q(j));for(var k=h.length-1;k>=0;k--)h[k].key===f&&(d.cancel(h[k].promise),h.splice(k,1))}i[a].removeItem(q(f))}catch(d){c.$broadcast("WindowStorageModule.error",{message:d.message,method:"remove",key:f,storageType:a}),b=!1}}return b},v=function(a,d){if(!o())return null;a=p(a)?a:g,b.isUndefined(d)&&(d="");var e=q(["__window_storage_TTL",d].join("."));d=q(d);var h=[];for(var j in i[a])if(j.substr(0,e.length)!==e&&j.substr(0,d.length)===d)try{h.push(j.substr(f.length))}catch(b){c.$broadcast("WindowStorageModule.error",{message:b.message,method:"getKeys",key:j,storageType:a})}return h},w=function(a){if(!o())return!1;a=p(a)?a:g;var b=v(a);return 0===b.length||(b.splice(0,0,a),u.apply(this,b))},x=function(){return g},y=function(a){return!!p(a)&&(g=a,!0)},z=function(){return f},A=function(){return w("localStorage")&&w("sessionStorage")},B={set:function(a,b,c){return r("sessionStorage",a,b,c)},get:function(a){return t("sessionStorage",a)},remove:function(){var a=Array.prototype.slice.call(arguments);return a.splice(0,0,"sessionStorage"),u.apply(this,a)},getKeys:function(a){return v("sessionStorage",a)},clear:function(){return w("sessionStorage")},setTTL:function(a,b){return s("sessionStorage",a,b)}},C={set:function(a,b,c){return r("localStorage",a,b,c)},get:function(a){return t("localStorage",a)},remove:function(){var a=Array.prototype.slice.call(arguments);return a.splice(0,0,"localStorage"),u.apply(this,a)},getKeys:function(a){return v("localStorage",a)},clear:function(){return w("localStorage")},setTTL:function(a,b){return s("localStorage",a,b)}};return function(){j.settings=k(),j.storage=l(),j.storageTTl=m(),c.$on("$destroy",function(){for(var a=h.length-1;a>=0;a--)d.cancel(h[a].promise),h.splice(a,1);h=null,i=null,j=null})}(),{sessionStorage:B,localStorage:C,clearAll:A,clear:w.bind(this,null),clearSessionStorage:B.clear,clearLocalStorage:C.clear,getKeys:v.bind(this,null),getKeysFromSessionStorage:B.getKeys,getKeysFromLocalStorage:C.getKeys,remove:u.bind(this,null),removeFromSessionStorage:B.remove,removeFromLocalStorage:C.remove,get:t.bind(this,null),getFromSessionStorage:B.get,getFromLocalStorage:C.get,set:r.bind(this,null),setToSessionStorage:B.set,setToLocalStorage:C.set,setTTL:s.bind(this,null),setTTLToSessionStorage:B.setTTL,setTTLToLocalStorage:C.setTTL,getDefaultStorageType:x,setDefaultStorageType:y,getPrefix:z}}]})}(window,window.angular);
//# sourceMappingURL=angular-window-storage.min.js.map