/**
* angular-window-storage 
* Angular module to ease the access of localStorage, sessionStorage and cookie. 
* Author: Jose Rocha 
* Version: 0.2.0 
* Date: 2017-05-10 
* Project github: https://github.com/JoseCMRocha/angular-window-storage
* License: MIT 
*/
!function(a,b){b.module("WindowStorageModule",[]).provider("windowStorageService",function(a){var c=["__","WINDOW_STORAGE_TTL"].join(""),d=[".","__","CHUNK"].join("");this._defaults={prefix:"ws_",storageType:"sessionStorage",cookies:{path:null,domain:null,ttl:2592e6,secure:!1},allowWebStorage:!0,allowCookies:!0,defaultToCookies:!0,cookiesEncoderComponentFn:encodeURIComponent,cookiesDecoderComponentFn:decodeURIComponent,webStorageEncoderComponentFn:null,webStorageDecoderComponentFn:null},this.setPrefix=function(a){return b.isString(a)&&(this._defaults.prefix=a),this},this.setDefaultStorageType=function(a){return"sessionStorage"!==a&&"localStorage"!==a&&"cookie"!==a||(this._defaults.storageType=a),this},this.setCookiesPath=function(a){return b.isString(a)&&(this._defaults.cookies.path=a),this},this.setCookiesDomain=function(a){return b.isString(a)&&(this._defaults.cookies.domain=a),this},this.setCookiesExpires=function(a){return b.isNumber(a)&&a>0&&(this._defaults.cookies.expires=a),b.isDate(a)&&(this._defaults.cookies.expires=+new Date(a)),this},this.setCookiesSecure=function(a){return"boolean"==typeof a&&(this._defaults.cookies.secure=a),this},this.setCookiesDefaults=function(a){return b.isObject(a)&&(a.path&&setCookiesPath(a.path),a.domain&&setCookiesDomain(a.domain),a.expires&&setCookiesExpires(a.expires),a.secure&&setCookiesSecure(a.secure)),this},this.setAllowWebStorage=function(a){return"boolean"==typeof a&&(this._defaults.allowWebStorage=a),this},this.setAllowCookies=function(a){return"boolean"==typeof a&&(this._defaults.allowCookies=a),this},this.setDefaultToCookies=function(a){return"boolean"==typeof a&&(this._defaults.defaultToCookies=a),this},this.setCookiesEncoderComponentFn=function(a){return b.isFunction(a)&&(this._defaults.cookiesEncoderComponentFn=a),this},this.setCookiesDecoderComponentFn=function(a){return b.isFunction(a)&&(this._defaults.cookiesDecoderComponentFn=a),this},this.setWebStorageEncoderComponentFn=function(a){return b.isFunction(a)&&(this._defaults.webStorageEncoderComponentFn=a),this},this.setWebStorageDecoderComponentFn=function(a){return b.isFunction(a)&&(this._defaults.webStorageDecoderComponentFn=a),this},this.$get=["$window","$rootScope","$timeout","$document","$browser",function(a,e,f,g,h){var i=this,j=i._defaults,k=[],l={settings:null,webStorage:null,cookies:null,storageTTl:null},m=function(){try{return"."!==j.prefix.substr(-1)&&(j.prefix=j.prefix?j.prefix+".":""),!0}catch(a){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_FAILED_TO_INIT_SETTINGS",message:a.message}),!1}},n=function(){if(!j.allowWebStorage)return!1;try{var b=function(b){var c=b in a&&null!==a[b];if(c){var d=q(Math.round(1e4*Math.random()));a[b].setItem(b,d,""),a[b].removeItem(b,d)}return c},c=b("localStorage"),d=b("sessionStorage");return c&&d}catch(a){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_FAILED_TO_INIT_WEB_STORAGE",message:a.message}),!1}},o=function(){if(!j.allowCookies)return!1;try{var c=b.isDefined(a.navigator)&&a.navigator.cookieEnabled||b.isDefined(g.cookie);if(c){var d=Math.round(1e4*Math.random()),f=Math.round(1e4*Math.random());t(d,f),c=g.cookie.indexOf(j.cookiesEncoderComponentFn(d))>-1,t(d,null)}return c}catch(a){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_FAILED_TO_INIT_COOKIE_STORAGE",message:a.message}),!1}},p=function(){if(!l.webStorage)return!1;var a=function(a){var b=I(a);try{for(var d in b){var f=b[d],g=E(a,[c,f].join("."));g&&C(a,f,g-+new Date)}return!0}catch(b){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_FAILED_TO_INIT_STORAGE_TTL",message:b.message,storageType:a}),!1}},b=a("localStorage"),d=a("sessionStorage");return b&&d},q=function(a){return j.prefix+a},r=function(a,b,c,f,g,h){var i=j.cookiesEncoderComponentFn(a),k=j.cookiesEncoderComponentFn(b),l=f?";path="+f:"";l+=g?";domain="+g:"",l+=c?";expires="+c.toUTCString():"",l+=h?";secure":"";var m=k.length,n=i.length+l.length,o=m+n+1,p=d.length+"0000".length+"OF".length+"0000".length;if(o>4093&&n+p<4093){var q=Math.ceil(m/(4093-n-p)),r=("0000"+q).slice(-"0000".length);q>30&&e.$broadcast("WindowStorageModule.warning",{type:"WINDOW_STORAGE_COOKIE_STORAGE_VALUE_TO_BIG",message:"Cookie '"+a+"' possibly not set or overflowed because it was too large even to divide in chunks ("+q+" > 30 chunks)!"});for(var s=[],t=Math.ceil(m/q),u=0;u<q;u++){var v=u+1,w=("0000"+v).slice(-"0000".length),x=[i,d,w,"OF",r].join("");x+="="+k.substr(u*t,t),x+=l,s.push(x)}return s}return o>4093&&e.$broadcast("WindowStorageModule.warning",{type:"WINDOW_STORAGE_COOKIE_STORAGE",message:"Cookie '"+a+"' possibly not set or overflowed because it was too large ("+o+" > 4093 bytes)!"}),[i+"="+k+l]},s=function(a,c,e,f){var h=new Date(0),i=j.cookiesEncoderComponentFn(a),k=[i,d].join(""),l=j.cookiesEncoderComponentFn(""),m=c?";path="+c:"";m+=e?";domain="+e:"",m+=h?";expires="+h.toUTCString():"",m+=f?";secure":"";var n=g.cookie;n=n.replace(/\s/g,"");var o=[],p=n.split(";");for(var q in p){var r=p[q].split("="),s=r[0];if(b.isDefined(s)&&(s===i||s.indexOf(k)>-1)){var t=s+"=";t+=l,t+=m,o.push(t)}}return o},t=function(a,c,d){d=v(d);var e,f=d.path,i=d.ttl,k=d.domain,l=d.secure;f=b.isUndefined(f)?null===j.cookies.path?h.baseHref():j.cookies.path:f;var m=+new Date;e=b.isUndefined(i)?new Date(m+j.cookies.ttl):b.isDate(i)?i:b.isNumber(i)?new Date(m+i):new Date(0),k=b.isUndefined(k)?null===j.cookies.domain?"":j.cookies.domain:k,l=b.isUndefined(l)?j.cookies.secure:l;var n=s(a,f,k,l);for(var o in n)g.cookie=n[o];if(!(b.isUndefined(c)||null===c||e<new Date(m))){n=r(a,c,e,f,k,l);for(var p in n)g.cookie=n[p]}},u=function(){var a=g.cookie;a=a.replace(/\s/g,"");var c={},e=a.split(";");for(var f in e){var h=e[f].split("="),i=h[0].split(d),k=j.cookiesDecoderComponentFn(i[0]);if(k){var l=h[1];if(b.isDefined(i[1])){var m=i[1].split("OF"),n=parseInt(m[0]),o=parseInt(m[1]),p=c[k]||"";n==o?c[k]+=l:c[k]=p.slice(0,(n-1)*l.length)+l+p.slice((n-1)*l.length)}else c[k]=l}}for(var q in c)c.hasOwnProperty(q)&&(c[q]=j.cookiesDecoderComponentFn(c[q]));return c},v=function(a){return b.isNumber(a)||b.isDate(a)?{ttl:a}:a||{}},w=function(a,b){var c=j.prefix;j.prefix=[c,"__",a,"."].join("");var d=b();return j.prefix=c,d},x=function(a){return"sessionStorage"===a||"localStorage"===a||"cookie"===a},y=function(a){return"sessionStorage"===a||"localStorage"===a},z=function(a){return"cookie"===a},A=function(c,d,f,g){if(x(c)||(c=j.storageType),y(c)&&!l.webStorage)return!!j.defaultToCookies&&w(c,B.bind(this,d,f,g));if(z(c))return B(d,f,g);if(g=v(g),b.isUndefined(f)||null===f)return G(c,d);try{var h=b.toJson(f);return j.webStorageEncoderComponentFn&&j.webStorageDecoderComponentFn&&(h=j.webStorageEncoderComponentFn(h)),a[c].setItem(q(d),h),!g.ttl||C(c,d,g.ttl)}catch(a){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_SET_METHOD",message:a.message,key:d,storageType:c}),!1}},B=function(a,c,d){if(!l.cookies)return!1;if(b.isUndefined(c)||null===c)return H(a);d=v(d);try{return t(q(a),b.toJson(c),d.ttl,d.path,d.domain,d.secure),!0}catch(b){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_SET_COOKIE_METHOD",message:b.message,key:a,storageType:"cookie"}),!1}},C=function(d,e,g){if(x(d)||(d=j.storageType),y(d)&&!l.webStorage)return!!j.defaultToCookies&&w(d,D.bind(this,e,g));if(z(d))return D(e,g);g=v(g);var h=g.ttl,i=+new Date;if(0===(h=b.isDate(h)?+new Date(new Date(h)-i):b.isNumber(h)?h:0))return!0;if(h<0&&G(d,e),q(e)in a[d]){var m=[c,e].join(".");if(q(m)in a[d]){a[d].removeItem(q(m));for(var n=k.length-1;n>=0;n--)k[n].key===e&&(f.cancel(k[n].promise),k.splice(n,1))}var o=+new Date(i+h),p=f(function(){G(d,e)},h);k.push({key:e,promise:p}),A(d,m,o)}return!0},D=function(a,b){if(!l.cookies)return!1;b=v(b);var c=u()[q(a)];try{return t(q(a),c,b.ttl,b.path,b.domain,b.secure),!0}catch(b){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_SET_TTL_COOKIE_METHOD",message:b.message,key:a,storageType:"cookie"}),!1}},E=function(c,d){if(x(c)||(c=j.storageType),y(c)&&!l.webStorage)return j.defaultToCookies?w(c,F.bind(this,d)):null;if(z(c))return F(d);try{var f=a[c].getItem(q(d));j.webStorageEncoderComponentFn&&j.webStorageDecoderComponentFn&&(f=j.webStorageDecoderComponentFn(f));try{return b.fromJson(f)}catch(a){return f}}catch(a){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_GET_METHOD",message:a.message,method:"get",key:d,storageType:c}),null}},F=function(a){if(!l.cookies)return null;try{var c=u()[q(a)];b.isUndefined(c)&&(c=null);try{return b.fromJson(c)}catch(a){return c}}catch(b){return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_GET_COOKIE_METHOD",message:b.message,key:a,storageType:"cookie"}),null}},G=function(){if(arguments.length<2)return e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_WRONG_NUMBER_OF_ARGUMENTS"}),!1;var b=Array.prototype.slice.call(arguments),d=b.splice(0,1)[0];if(x(d)||(d=j.storageType),y(d)&&!l.webStorage){if(!j.defaultToCookies)return!1;return w(d,function(a){return H.apply(this,a)}.bind(this,b))}if(z(d))return H.apply(this,b);var g=!0;for(var h in b){var i=b[h];try{var m=[c,i].join(".");if(q(m)in a[d]){a[d].removeItem(q(m));for(var n=k.length-1;n>=0;n--)k[n].key===i&&(f.cancel(k[n].promise),k.splice(n,1))}a[d].removeItem(q(i))}catch(a){e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_REMOVE_METHOD",message:a.message,key:i,storageType:d}),g=!1}}return g},H=function(){if(!l.cookies)return!1;for(var a=!0,b=0;b<arguments.length;b++){var c=arguments[b];try{t(q(c),null)}catch(b){e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_REMOVE_COOKIE_METHOD",message:b.message,key:c,storageType:"cookie"}),a=!1}}return a},I=function(d,f){if(x(d)||(d=j.storageType),y(d)&&!l.webStorage)return j.defaultToCookies?w(d,J.bind(this,f)):null;if(z(d))return J(f);b.isUndefined(f)&&(f="");var g=q([c,f].join("."));f=q(f);var h=[];for(var i in a[d])if(i.substr(0,g.length)!==g&&i.substr(0,f.length)===f)try{h.push(i.substr(j.prefix.length))}catch(a){e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_GETKEYS_METHOD",message:a.message,key:i,storageType:d})}return h},J=function(a){if(!l.cookies)return null;b.isUndefined(a)&&(a=""),a=q(a);var c=[],d=Object.keys(u());for(var f in d){var g=d[f];if("__"!==g.substr(j.prefix.length,"__".length)&&g.substr(0,a.length)===a)try{c.push(g.substr(j.prefix.length))}catch(a){e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_GETKEYS_COOKIES_METHOD",message:a.message,key:g,storageType:"cookie"})}}return c},K=function(a,b){if(z(a))return L(b);var c=I(a,b)||[];return 0===c.length||(c.splice(0,0,a),G.apply(this,c))},L=function(a){var b=J(a)||[];return 0===b.length||H.apply(this,b)},M=function(a){return z(a)?N():(I(a)||[]).length},N=function(){return(J()||[]).length},O=function(a,b){return z(a)?P(b):(I(a)||[]).indexOf(b)},P=function(a){return(J()||[]).indexOf(a)},Q=function(){return j.storageType},R=function(a){return!!x(a)&&(j.storageType=a,!0)},S=function(){return j.prefix},T=function(){var a=K("localStorage"),b=K("sessionStorage"),c=L();return a&&b&&c},U=function(a,b,c,d){return b.indexOf("__")>-1?(e.$broadcast("WindowStorageModule.error",{type:"WINDOW_STORAGE_SET_METHOD",message:"Reserved key '__'",key:b,storageType:a}),!1):A(a,b,c,d)},V=function(a){return{set:U.bind(this,a),get:E.bind(this,a),remove:G.bind(this,a),getKeys:I.bind(this,a),clear:K.bind(this,a),setTTL:C.bind(this,a),length:M.bind(this,a),key:O.bind(this,a)}},W=V("sessionStorage"),X=V("localStorage"),Y=V("cookie");return function(){g?g[0]&&(g=g[0]):g=document,l.settings=m(),l.webStorage=n(),l.cookies=o(),l.storageTTl=p()}(),{sessionStorage:W,localStorage:X,cookies:Y,clearAll:T,clear:K.bind(this,null),clearSessionStorage:W.clear,clearLocalStorage:X.clear,clearCookies:Y.clear,getKeys:I.bind(this,null),getKeysFromSessionStorage:W.getKeys,getKeysFromLocalStorage:X.getKeys,getKeysFromCookies:Y.getKeys,remove:G.bind(this,null),removeFromSessionStorage:W.remove,removeFromLocalStorage:X.remove,removeFromCookies:Y.remove,get:E.bind(this,null),getFromSessionStorage:W.get,getFromLocalStorage:X.get,getFromCookies:Y.get,set:U.bind(this,null),setToSessionStorage:W.set,setToLocalStorage:X.set,setToCookies:Y.set,setTTL:C.bind(this,null),setTTLToSessionStorage:W.setTTL,setTTLToLocalStorage:X.setTTL,setTTlToCookies:Y.setTTL,length:M.bind(this,null),lengthOfSessionStorage:W.length,lengthOfLocalStorage:X.length,lengthOfCookies:Y.length,key:O.bind(this,null),keySessionStorage:W.length,keyLocalStorage:X.length,keyCookies:Y.length,getDefaultStorageType:Q,setDefaultStorageType:R,getPrefix:S}}]})}(window,window.angular);
//# sourceMappingURL=angular-window-storage.min.js.map